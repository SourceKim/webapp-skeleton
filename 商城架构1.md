# 简介

# 设计

## 数据库设计

### 商品品牌表（product_brands）

**表名：**  `product_brands`

| 字段名      | 类型     | 数据库类型                 | 可否为空 | 主键/外键           | 描述     | 示例数据            |
| ------------- | ---------- | ---------------------------- | ---------- | --------------------- | ---------- | --------------------- |
| id          | string   | VARCHAR(36)                | 否       | 主键                | 品牌ID   | brand_abc123        |
| name        | string   | VARCHAR(50)                | 否       | 唯一索引            | 品牌名称 | 苹果                |
| description | string   | VARCHAR(200)               | 是       |                     | 品牌描述 | 美国知名科技公司    |
| material_id | string   | VARCHAR(36)                | 是       | 外键→materials(id) | 品牌Logo | mat_abc123          |
| website     | string   | VARCHAR(200)               | 是       |                     | 官方网站 | [https://www.apple.com](https://www.apple.com/)                    |
| status      | enum     | ENUM('ENABLED','DISABLED') | 否       |                     | 状态     | ENABLED             |
| created_at  | datetime | DATETIME                   | 否       |                     | 创建时间 | 2025-10-28 10:00:00 |
| updated_at  | datetime | DATETIME                   | 否       |                     | 更新时间 | 2025-10-28 10:05:00 |
| deleted_at  | datetime | DATETIME                   | 是       |                     |          |                     |

### 商品分类表（product_categories）

| 字段名      | 类型     | 数据库类型                 | 可否为空 | 主键/外键                    | 描述     | 示例数据            |
| ------------- | ---------- | ---------------------------- | ---------- | ------------------------------ | ---------- | --------------------- |
| id          | string   | VARCHAR(36)                | 否       | 主键                         | 分类ID   | cat_abc123          |
| name        | string   | VARCHAR(50)                | 否       |                              | 分类名称 | 手机                |
| description | string   | VARCHAR(200)               | 是       |                              | 分类描述 | 智能手机分类        |
| parent_id   | string   | VARCHAR(36)                | 是       | 外键→product_categories(id) | 父分类ID | cat_parent01        |
| level       | number   | INT                        | 否       |                              | 分类层级 | 2                   |
| material_id | string   | VARCHAR(36)                | 是       | 外键→materials(id)          | 分类图片 | mat_abc123          |
| status      | enum     | ENUM('ENABLED','DISABLED') | 否       |                              | 状态     | ENABLED             |
| created_at  | datetime | DATETIME                   | 否       |                              | 创建时间 | 2025-10-28 10:00:00 |
| updated_at  | datetime | DATETIME                   | 否       |                              | 更新时间 | 2025-10-28 10:05:00 |
| deleted_at  | datetime | DATETIME                   | 是       |                              |          |                     |

### 商品SPU表（product_spu）

| 字段名         | 类型     | 数据库类型                           | 可否为空 | 主键/外键                    | 描述               | 示例数据                |
| ---------------- | ---------- | -------------------------------------- | ---------- | ------------------------------ | -------------------- | ------------------------- |
| id             | string   | VARCHAR(36)                          | 否       | 主键                         | SPU唯一标识        | spu_abc123              |
| name           | string   | VARCHAR(255)                         | 否       |                              | 商品名称           | 智能手机                |
| sub_title      | string   | VARCHAR(500)                         | 是       |                              | 商品副标题         | 旗舰级智能手机          |
| description    | string   | TEXT                                 | 是       |                              | 商品描述           | 这是一款旗舰智能手机... |
| category_id    | string   | VARCHAR(36)                          | 是       | 外键→product_categories(id) | 分类ID             | cat_abc123              |
| brand_id       | string   | VARCHAR(36)                          | 是       | 外键→product_brands(id)     | 品牌ID             | brand_abc123            |
| status         | enum     | ENUM('DRAFT','ON_SHELF','OFF_SHELF') | 否       |                              | 商品状态           | ON_SHELF                |
| main_material  | string   | VARCHAR(36)                          | 是       | 外键→materials(id)          | 主图素材ID         | mat_abc123              |
| sub_materials  | json     | JSON                                 | 是       |                              | 商品图集素材ID数组 | ["mat1", "mat2"]        |
| detail_content | string   | TEXT                                 | 是       |                              | 商品详情内容(HTML) | `<div>商品详情...</div>`                        |
| created_at     | datetime | DATETIME                             | 否       |                              | 创建时间           | 2025-10-28 10:00:00     |
| updated_at     | datetime | DATETIME                             | 否       |                              | 更新时间           | 2025-10-28 10:05:00     |
| deleted_at     | datetime | DATETIME                             | 是       |                              | 软删除时间         | null                    |

### SKU 相关

#### 商品SKU表（product_sku）

| 字段名         | 类型     | 数据库类型                   | 可否为空      | 主键/外键             | 描述        | 示例数据             |
| ---------------- | ---------- | ------------------------------ | --------------- | ----------------------- | ------------- | ---------------------- |
| id             | string   | VARCHAR(36)                  | 否            | 主键                  | SKU唯一标识 | sku_abc123           |
| spu_id         | string   | VARCHAR(36)                  | 否            | 外键→product_spu(id) | SPU ID      | spu_abc123           |
| sku_code       | string   | VARCHAR(100)                 | 否            |                       | SKU编码     | 暂时和 id 一致       |
| sku_name       | string   | VARCHAR(500)                 | 是            |                       | SKU名称     | 智能手机 黑色 128G   |
| price          | decimal  | DECIMAL(10,2)                | 否            |                       | 销售价格    | 5999.00              |
| original_price | decimal  | DECIMAL(10,2)                | 是            |                       | 原价/市场价 | 6999.00 （划线价格） |
| cost_price     | decimal  | DECIMAL(10,2)                | 是            |                       | 成本价      | 5000.00              |
| stock          | number   | INT                          | 否            |                       | 总库存数量  | 100                  |
| status         | enum     | ENUM('ON_SHELF','OFF_SHELF') | 否            |                       | SKU状态     | ON_SHELF             |
| is_default     | boolean  | BOOLEAN                      | 否(默认false) |                       | 是否默认SKU | true                 |
| created_at     | datetime | DATETIME                     | 否            |                       | 创建时间    | 2025-10-28 10:00:00  |
| updated_at     | datetime | DATETIME                     | 否            |                       | 更新时间    | 2025-10-28 10:05:00  |
| deleted_at     | datetime | DATETIME                     | 是            |                       |             |                      |

#### 商品属性key表（product_attribute_keys）

| 字段名     | 类型     | 数据库类型                   | 可否为空      | 主键/外键             | 描述     | 示例数据            |
| ------------ | ---------- | ------------------------------ | --------------- | ----------------------- | ---------- | --------------------- |
| id         | string   | VARCHAR(36)                  | 否            | 主键                  | 属性键ID | attr_key_abc123     |
| spu_id     | string   | VARCHAR(36)                  | 否            | 外键→product_spu(id) | SPU ID   | spu_abc123          |
| name       | string   | VARCHAR(50)                  | 否            |                       | 属性名称 | 颜色                |
| key        | string   | VARCHAR(50)                  | 否            |                       | 属性键名 | color               |
| type       | enum     | ENUM('TEXT','COLOR','IMAGE') | 否            |                       | 属性类型 | COLOR               |
| required   | boolean  | BOOLEAN                      | 否(默认false) |                       | 是否必选 | true                |
| created_at | datetime | DATETIME                     | 否            |                       | 创建时间 | 2025-10-28 10:00:00 |
| updated_at | datetime | DATETIME                     | 否            |                       |          |                     |

#### 商品属性value表（product_attribute_values）

| 字段名           | 类型     | 数据库类型   | 可否为空 | 主键/外键                        | 描述       | 示例数据            |
| ------------------ | ---------- | -------------- | ---------- | ---------------------------------- | ------------ | --------------------- |
| id               | string   | VARCHAR(36)  | 否       | 主键                             | 属性值ID   | attr_val_abc123     |
| attribute_key_id | string   | VARCHAR(36)  | 否       | 外键→product_attribute_keys(id) | 属性键ID   | attr_key_abc123     |
| value            | string   | VARCHAR(100) | 否       |                                  | 属性值     | 黑色                |
| value_id         | string   | VARCHAR(100) | 否       |                                  | 属性值ID   | color_black         |
| image_id         | string   | VARCHAR(36)  | 是       | 外键→materials(id)              | 图片素材ID | mat_color_black     |
| color_hex        | string   | VARCHAR(7)   | 是       |                                  | 颜色值     | #000000             |
| created_at       | datetime | DATETIME     | 否       |                                  | 创建时间   | 2025-10-28 10:00:00 |
| updated_at       | datetime | DATETIME     | 否       |                                  |            |                     |

#### SKU属性关联表（product_sku_attributes）

| 字段名             | 类型     | 数据库类型  | 可否为空 | 主键/外键                          | 描述     | 示例数据        |
| -------------------- | ---------- | ------------- | ---------- | ------------------------------------ | ---------- | ----------------- |
| id                 | string   | VARCHAR(36) | 否       | 主键                               | 关联ID   | sku_attr_abc123 |
| sku_id             | string   | VARCHAR(36) | 否       | 外键→product_sku(id)              | SKU ID   | sku_abc123      |
| attribute_key_id   | string   | VARCHAR(36) | 否       | 外键→product_attribute_keys(id)   | 属性键ID | attr_key_abc123 |
| attribute_value_id | string   | VARCHAR(36) | 否       | 外键→product_attribute_values(id) | 属性值ID | attr_val_abc123 |
| created_at         | datetime | DATETIME    | 否       |                                    |          |                 |

## API 设计

### 品牌管理

| 路由路径 | 方法   | 描述         | 权限        | 请求参数 | 响应数据     |
| ---------- | -------- | -------------- | ------------- | ---------- | -------------- |
| `/api/v1/admin/products/brands`         | GET    | 品牌列表     | 管理员/用户 | -        |              |
| `/api/v1/admin/products/brands`         | POST   | 创建品牌     | 管理员      | 品牌参数 | 创建的品牌   |
| `/api/v1/admin/products/brands/:id`         | GET    | 获取品牌详情 | 管理员/用户 | -        | 品牌详情     |
| `/api/v1/admin/products/brands/:id`         | PUT    | 更新品牌     | 管理员      | 品牌参数 | 更新后的品牌 |
| `/api/v1/admin/products/brands/:id`         | DELETE | 删除品牌     | 管理员      | -        |              |

### 分类管理

| 路由路径 | 方法   | 描述         | 权限        | 请求参数 | 响应数据     |
| ---------- | -------- | -------------- | ------------- | ---------- | -------------- |
| `/api/v1/admin/products/categories`         | GET    | 分类列表     | 管理员/用户 | `parent_id`, `level`       |              |
| `/api/v1/admin/products/categories`         | POST   | 创建分类     | 管理员      | 分类参数 | 创建的分类   |
| `/api/v1/admin/products/categories/:id`         | GET    | 获取分类详情 | 管理员/用户 | -        | 分类详情     |
| `/api/v1/admin/products/categories/:id`         | PUT    | 更新分类     | 管理员      | 分类参数 | 更新后的分类 |
| `/api/v1/admin/products/categories/:id`         | DELETE | 删除分类     | 管理员      | -        |              |

- 获取层级  0 的分类，此时不用传入 parent_id，非首层的分类获取需要传入 parent_id

### SPU 管理

| 路由路径 | 方法   | 描述            | 权限        | 请求参数    | 响应数据    |
| ---------- | -------- | ----------------- | ------------- | ------------- | ------------- |
| `/api/v1/admin/products/spu`         | GET    | SPU列表（分页） | 管理员/用户 | `page`, `size`, `status`, `brand_id`      |             |
| `/api/v1/admin/products/spu/:id`         | GET    | 获取SPU详情     | 管理员/用户 | -           | SPU完整信息 |
| `/api/v1/admin/products/spu`         | POST   | 创建SPU         | 管理员      | SPU创建参数 | 创建的SPU   |
| `/api/v1/admin/products/spu/:id`         | PUT    | 更新SPU         | 管理员      | SPU更新参数 | 更新后的SPU |
| `/api/v1/admin/products/spu/:id`         | DELETE | 删除SPU         | 管理员      | -           |             |
| `/api/v1/admin/products/spu/:id/status`         | PUT    | 更新SPU状态     | 管理员      | `{ status: "ON_SHELF" }`            |             |

### SKU 管理

| 路由路径 | 方法   | 描述            | 权限        | 请求参数    | 响应数据    |
| ---------- | -------- | ----------------- | ------------- | ------------- | ------------- |
| `/api/v1/admin/products/sku`         | GET    | SKU列表（分页） | 管理员/用户 | `page`, `size`, `spu_id`, `status`      |             |
| `/api/v1/admin/products/sku/:id`         | GET    | 获取SKU详情     | 管理员/用户 | -           | SKU完整信息 |
| `/api/v1/admin/products/sku`         | POST   | 创建SKU         | 管理员      | SKU创建参数 | 创建的SKU   |
| `/api/v1/admin/products/sku/:id`         | PUT    | 更新SKU         | 管理员      | SKU更新参数 | 更新后的SKU |
| `/api/v1/admin/products/sku/:id`         | DELETE | 删除SKU         | 管理员      | -           |             |
| `/api/v1/admin/products/sku/:id/status`         | PUT    | 更新SKU状态     | 管理员      | `{ status: "ON_SHELF" }`            |             |
| `/api/v1/admin/products/sku/:id/stock`         | PUT    | 更新SKU库存     | 管理员      | `{ stock: 100 }`            |             |

### SKU属性管理

| 路由路径 | 方法   | 描述            | 权限   | 请求参数    | 响应数据       |
| ---------- | -------- | ----------------- | -------- | ------------- | ---------------- |
| `/api/v1/admin/products/attributes/keys`         | GET    | 属性键列表      | 管理员 | `spu_id`            |                |
| `/api/v1/admin/products/attributes/keys`         | POST   | 创建属性键      | 管理员 | 属性键参数  | 创建的属性键   |
| `/api/v1/admin/products/attributes/keys/:id`         | PUT    | 更新属性键      | 管理员 | 属性键参数  | 更新后的属性键 |
| `/api/v1/admin/products/attributes/keys/:id`         | DELETE | 删除属性键      | 管理员 | -           |                |
| `/api/v1/admin/products/attributes/values`         | POST   | 创建属性值      | 管理员 | 属性值参数  | 创建的属性值   |
| `/api/v1/admin/products/attributes/values/:id`         | PUT    | 更新属性值      | 管理员 | 属性值参数  | 更新后的属性值 |
| `/api/v1/admin/products/attributes/values/:id`         | DELETE | 删除属性值      | 管理员 | -           |                |
| `/api/v1/admin/products/spu/:id/generate-skus`         | POST   | 根据属性生成SKU | 管理员 | SKU模板数组 |                |

# 页面与交互

## 管理端

## 应用端

### 品牌管理页面

| 用户操作       | 页面反馈           | API调用 | 请求数据     | 响应处理                             |
| ---------------- | -------------------- | --------- | -------------- | -------------------------------------- |
| 页面加载       | 显示品牌列表表格   | `GET /api/v1/admin/products/brands`        | 无           | 渲染品牌列表，包含名称、Logo、状态等 |
| 点击"新增品牌" | 弹出品牌表单对话框 | 无      | 无           | 显示空表单等待输入                   |
| 填写品牌表单   | 实时表单验证       | 无      | 无           | 检查必填字段，显示错误提示           |
| 点击Logo上传   | 打开文件选择器     | `POST /api/v1/materials/admin/upload`        | FormData文件 | 上传成功返回material_id，显示预览图  |
| 点击"保存"     | 显示加载状态       | `POST /api/v1/admin/products/brands`        | `{name: "苹果", description: "...", material_id: "mat_123", status: "ENABLED"}`             | 保存成功关闭对话框，刷新列表         |
| 点击"编辑"     | 弹出预填表单       | `GET /api/v1/admin/products/brands/:id`        | 无           | 用品牌数据填充表单                   |
| 点击"删除"     | 弹出确认对话框     | `DELETE /api/v1/admin/products/brands/:id`        | 无           | 删除成功从列表中移除                 |
| 点击状态开关   | 立即切换状态       | `PUT /api/v1/admin/products/brands/:id`        | `{status: "DISABLED"}`             | 更新品牌状态，无需刷新页面           |

### 分类管理页面 

| 用户操作       | 页面反馈         | API调用 | 请求数据     | 响应处理                   |
| ---------------- | ------------------ | --------- | -------------- | ---------------------------- |
| 页面加载       | 显示分类树形结构 | `GET /api/v1/admin/products/categories`        | `parent_id=null`             | 渲染顶级分类列表           |
| 点击分类展开   | 显示子分类       | `GET /api/v1/admin/products/categories`        | `parent_id=当前分类ID`             | 加载并显示子分类           |
| 点击"新增分类" | 弹出分类表单     | 无      | 无           | 显示表单，可选择父分类     |
| 选择父分类     | 更新层级显示     | 无      | 无           | 自动计算并显示层级level    |
| 点击图片上传   | 打开文件选择器   | `POST /api/v1/materials/admin/upload`        | FormData文件 | 上传分类图片               |
| 点击"保存"     | 显示加载状态     | `POST /api/v1/admin/products/categories`        | `{name: "手机", parent_id: "cat_1", level: 1, material_id: "mat_123"}`             | 保存成功，更新分类树       |
| 点击"编辑"     | 弹出预填表单     | `GET /api/v1/admin/products/categories/:id`        | 无           | 填充分类数据到表单         |
| 点击"删除"     | 检查子分类存在   | `GET /api/v1/admin/products/categories?parent_id=当前ID`        | 无           | 如有子分类提示先删除子分类 |
| 确认删除       | 删除分类         | `DELETE /api/v1/admin/products/categories/:id`        |              |                            |

### 商品管理页面

#### 商品SPU列表

- 列表展示基本信息
- 可以新增、编辑、删除 SPU
- 主要用以处理商品的基本信息，图片，详细描述等

#### SKU 管理页面

- 点击 SPU 列表的某一个 SPU，跳转到对应的 SKU 管理页面
- 页面布局，一共分为 3 个组，每个组都有标题：

  - SPU 基本信息：SPU 标题、ID
  - SKU 属性管理（带有新增按钮），卡片形式，一张卡片对应一个 sku-key 以及其对应的 sku-value(s)
  - SKU 列表 （带有生成 SKU 按钮），展示 SKU 表格，可以行内编辑价格、库存、状态等